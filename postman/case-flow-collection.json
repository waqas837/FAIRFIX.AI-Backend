{"info":{"name":"FAIRFIX Case Flow","description":"Test case flow: auth, create case (vehicle + shop required), verify, install window, decision lock, vendor, shop, appointment, shipment, install, post-confirmation. Run 0. Setup after Login to fill vehicleId, shopId, vendorId.","schema":"https://schema.getpostman.com/json/collection/v2.1.0/collection.json"},"variable":[{"key":"baseUrl","value":"http://localhost:3000/api/v1"},{"key":"authToken","value":""},{"key":"caseId","value":""},{"key":"installWindowId","value":""},{"key":"shipmentId","value":""},{"key":"vehicleId","value":""},{"key":"shopId","value":""},{"key":"vendorId","value":""}],"auth":{"type":"bearer","bearer":[{"key":"token","value":"{{authToken}}"}]},"item":[{"name":"0. Setup (run after Login)","item":[{"name":"Get Vehicles","event":[{"listen":"test","script":{"exec":["const j = pm.response.json();","const list = j.data || [];","if (list.length) pm.collectionVariables.set('vehicleId', list[0].id);"]}}],"request":{"method":"GET","url":"{{baseUrl}}/vehicles"}},{"name":"Get Shops","event":[{"listen":"test","script":{"exec":["const j = pm.response.json();","const list = j.data || [];","if (list.length) pm.collectionVariables.set('shopId', list[0].id);"]}}],"request":{"method":"GET","url":"{{baseUrl}}/shops"}},{"name":"Get Vendors","event":[{"listen":"test","script":{"exec":["const j = pm.response.json();","const list = j.data || [];","if (list.length) pm.collectionVariables.set('vendorId', list[0].id);"]}}],"request":{"method":"GET","url":"{{baseUrl}}/vendor"}}]},{"name":"1. Auth","item":[{"name":"Register","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"email\": \"customer@test.com\",\n  \"password\": \"Test123!\",\n  \"firstName\": \"Test\",\n  \"lastName\": \"User\",\n  \"role\": \"customer\"\n}"},"url":"{{baseUrl}}/auth/register"}},{"name":"Login","event":[{"listen":"test","script":{"exec":["const j = pm.response.json();","if (j.data && j.data.token) {","  pm.collectionVariables.set('authToken', j.data.token);","}"]}}],"request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"email\": \"customer@test.com\",\n  \"password\": \"Test123!\"\n}"},"url":"{{baseUrl}}/auth/login"}}]},{"name":"2. Case Flow","item":[{"name":"Create Case","event":[{"listen":"test","script":{"exec":["const j = pm.response.json();","if (j.data && j.data.id) {","  pm.collectionVariables.set('caseId', j.data.id);","}"]}}],"request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"vehicleId\": \"{{vehicleId}}\",\n  \"shopId\": \"{{shopId}}\"\n}"},"url":"{{baseUrl}}/cases"}},{"name":"Verify (start)","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{}"},"url":"{{baseUrl}}/cases/{{caseId}}/verify"}},{"name":"Verify (done)","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"verified\": true,\n  \"diagnosticSummary\": {\"notes\": \"O2 sensor\"},\n  \"recommendedParts\": [{\"sku\": \"SKU1\", \"qty\": 1}],\n  \"laborEstimateHours\": 1.5\n}"},"url":"{{baseUrl}}/cases/{{caseId}}/verify"}},{"name":"Propose Install Window","event":[{"listen":"test","script":{"exec":["const j = pm.response.json();","const w = j.data && j.data.installWindow;","if (w && w.id) pm.collectionVariables.set('installWindowId', w.id);"]}}],"request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"startAt\": \"2025-03-01T09:00:00.000Z\",\n  \"endAt\": \"2025-03-01T12:00:00.000Z\"\n}"},"url":"{{baseUrl}}/cases/{{caseId}}/install-window/propose"}},{"name":"Accept Install Window","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"installWindowId\": \"{{installWindowId}}\"\n}"},"url":"{{baseUrl}}/cases/{{caseId}}/install-window/accept"}},{"name":"Decision Lock","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"verifiedFacts\": [\"Part SKU1 required\"],\n  \"unknowns\": [\"Exact labor time\"],\n  \"remainingRisks\": [\"Backorder risk\"],\n  \"consentData\": { \"terms\": true, \"risks\": true },\n  \"installWindowStart\": \"2025-03-01T09:00:00.000Z\",\n  \"installWindowEnd\": \"2025-03-01T12:00:00.000Z\"\n}"},"url":"{{baseUrl}}/cases/{{caseId}}/decision-lock"}},{"name":"Vendor Availability Confirm","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"caseId\": \"{{caseId}}\",\n  \"vendorId\": \"{{vendorId}}\",\n  \"sku\": \"SKU1\",\n  \"quantity\": 1,\n  \"available\": true,\n  \"validUntil\": \"2025-04-01T00:00:00.000Z\",\n  \"leadTimeMinDays\": 2,\n  \"leadTimeMaxDays\": 5\n}"},"url":"{{baseUrl}}/vendor/availability-confirm"}},{"name":"Shop Window Confirm","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{}"},"url":"{{baseUrl}}/cases/{{caseId}}/shop-window-confirm"}},{"name":"Lock Appointment","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"slotStart\": \"2025-03-01T09:00:00.000Z\",\n  \"slotEnd\": \"2025-03-01T11:00:00.000Z\"\n}"},"url":"{{baseUrl}}/cases/{{caseId}}/appointment/lock"}},{"name":"Create Shipment","event":[{"listen":"test","script":{"exec":["const j = pm.response.json();","const d = j.data;","const id = d && (d.id || (d.shipment && d.shipment.id));","if (id) pm.collectionVariables.set('shipmentId', id);"]}}],"request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{}"},"url":"{{baseUrl}}/cases/{{caseId}}/shipments"}},{"name":"Update Shipment (tracking + alerts)","request":{"method":"PATCH","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"trackingNumber\": \"1Z999AA10123456784\",\n  \"alertsEnabled\": true,\n  \"carrierWebhookRegistered\": true\n}"},"url":"{{baseUrl}}/shipments/{{shipmentId}}"}},{"name":"Trigger Shipment","request":{"method":"POST","url":"{{baseUrl}}/shipments/{{shipmentId}}/trigger"}},{"name":"Shipment In Transit","request":{"method":"POST","url":"{{baseUrl}}/shipments/{{shipmentId}}/transit"}},{"name":"Shipment Delivered","request":{"method":"POST","url":"{{baseUrl}}/shipments/{{shipmentId}}/delivered"}},{"name":"Install Start","request":{"method":"POST","url":"{{baseUrl}}/cases/{{caseId}}/install-start"}},{"name":"Install Complete","request":{"method":"POST","url":"{{baseUrl}}/cases/{{caseId}}/install-complete"}},{"name":"Post Confirmation","request":{"method":"POST","url":"{{baseUrl}}/cases/{{caseId}}/post-confirmation"}}]},{"name":"3. Read","item":[{"name":"List Cases","request":{"method":"GET","url":"{{baseUrl}}/cases"}},{"name":"Get Case","request":{"method":"GET","url":"{{baseUrl}}/cases/{{caseId}}"}}]},{"name":"4. Exception","item":[{"name":"Record Exception","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"type\": \"VENDOR_DELAY\",\n  \"payload\": { \"reason\": \"Backorder\" }\n}"},"url":"{{baseUrl}}/cases/{{caseId}}/exceptions"}}]}]}
